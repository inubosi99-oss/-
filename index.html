<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>木材加工の案内所</title>

<style>
  :root{
    --bg:#f4f7fb;
    --card:#ffffff;
    --text:#1f2937;
    --muted:#6b7280;
    --line:rgba(17,24,39,0.10);
    --accent:#2563eb;
    --chip:#eaf0ff;
    --shadow:0 6px 20px rgba(0,0,0,0.08);
    --r:18px;
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP",system-ui,Segoe UI,Roboto,sans-serif;
    background:linear-gradient(180deg,#f9fbff 0%, var(--bg) 40%, #eef3fb 100%);
    color:var(--text);
  }

  header{
    position:sticky; top:0; z-index:10;
    background:rgba(255,255,255,0.85);
    backdrop-filter: blur(10px);
    border-bottom:1px solid var(--line);
  }
  .wrap{ max-width:1100px; margin:0 auto; padding:18px 16px; }
  h1{
    margin:0;
    font-size:34px;        /* タイトル大きめ */
    letter-spacing:0.04em;
    line-height:1.15;
  }
  .sub{
    margin-top:6px;
    color:var(--muted);
    font-size:14px;
  }

  main .grid{
    max-width:1100px;
    margin:0 auto;
    padding:16px;
    display:grid;
    grid-template-columns: 1.2fr 0.8fr;
    gap:16px;
  }
  @media (max-width: 900px){
    main .grid{ grid-template-columns:1fr; }
  }

  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:var(--r);
    box-shadow:var(--shadow);
    overflow:hidden;
  }
  .cardHead{
    padding:12px 14px;
    border-bottom:1px solid var(--line);
    display:flex;
    justify-content:space-between;
    gap:10px;
    align-items:center;
    background:linear-gradient(180deg, rgba(37,99,235,0.06), rgba(255,255,255,0));
  }
  .cardHead .title{
    font-size:14px;
    color:var(--muted);
    margin:0;
  }
  .chip{
    font-size:12px;
    color:var(--accent);
    background:var(--chip);
    border:1px solid rgba(37,99,235,0.20);
    padding:6px 10px;
    border-radius:999px;
    white-space:nowrap;
  }

  /* Player area */
  .playerArea{ padding:14px; }
  video{
    width:100%;
    border-radius:14px;
    background:#000;
    border:1px solid var(--line);
  }
  .desc{
    margin-top:10px;
    padding:10px 12px;
    border-radius:14px;
    background:rgba(17,24,39,0.03);
    border:1px solid var(--line);
    color:#374151;
    font-size:14px;
    line-height:1.65;
    white-space:pre-wrap;
  }

  .thumbs{
    margin-top:10px;
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:8px;
  }
  @media (max-width: 420px){
    .thumbs{ grid-template-columns: repeat(2, 1fr); }
  }
  .thumb{
    width:100%;
    aspect-ratio: 4/3;
    object-fit: cover;
    border-radius:14px;
    border:1px solid var(--line);
    background:#f2f2f2;
    cursor:pointer;
    touch-action: manipulation;
  }
  .thumb:active{ transform: translateY(1px); }

  /* List area */
  .listArea{ padding:12px; }
  input[type="search"]{
    width:100%;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid var(--line);
    outline:none;
    font-size:16px; /* iPadで押しやすく */
    background:#fff;
  }
  .count{
    margin:10px 2px 6px;
    color:var(--muted);
    font-size:12px;
  }
  ul{ list-style:none; padding:0; margin:0; display:grid; gap:8px; }

  .item{
    padding:12px 12px;
    border-radius:16px;
    border:1px solid var(--line);
    background:linear-gradient(180deg, rgba(17,24,39,0.02), rgba(255,255,255,0));
    cursor:pointer;
    display:flex;
    gap:10px;
    align-items:center;
    touch-action: manipulation;
  }
  .item:hover{ border-color: rgba(37,99,235,0.35); background: rgba(37,99,235,0.06); }
  .item.active{ border-color: rgba(37,99,235,0.55); background: rgba(37,99,235,0.10); }
  .num{
    min-width:38px; height:30px;
    display:grid; place-items:center;
    border-radius:12px;
    background:rgba(37,99,235,0.10);
    color:var(--accent);
    font-weight:700;
    font-size:12px;
    border:1px solid rgba(37,99,235,0.20);
  }
  .meta{ min-width:0; flex:1; }
  .name{
    font-size:15px;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .mini{
    font-size:12px;
    color:var(--muted);
    margin-top:2px;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }

  /* Modal */
  .modal{
    position:fixed; inset:0;
    background:rgba(0,0,0,0.75);
    display:none;
    z-index:100;
    align-items:center;
    justify-content:center;
    padding:12px;
  }
  .modalInner{
    width:min(980px, 100%);
    background:rgba(255,255,255,0.92);
    border-radius:18px;
    overflow:hidden;
    border:1px solid rgba(255,255,255,0.25);
    box-shadow: 0 16px 40px rgba(0,0,0,0.35);
  }
  .modalTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:10px 12px;
    background:rgba(255,255,255,0.85);
    border-bottom:1px solid rgba(0,0,0,0.10);
  }
  .modalTop .hint{
    font-size:12px;
    color:#374151;
  }
  .modalBtns{ display:flex; gap:8px; }
  .btn{
    border:1px solid rgba(0,0,0,0.12);
    background:#fff;
    border-radius:12px;
    padding:10px 12px;
    font-size:14px;
    cursor:pointer;
    touch-action: manipulation;
  }
  .btn:active{ transform: translateY(1px); }

  .modalImgWrap{
  background:#111;
  display:flex;
  align-items:center;
  justify-content:center;

  /* ★固定高さをやめる */
  height: auto;

  /* ★画面内に収まる範囲を自動で確保 */
  max-height: 88vh;          /* iPadでも見やすい上限 */
  padding: 10px;

  touch-action: pan-y;
}

.modalImg{
  /* ★画像を画面内に収めて最大化（見切れない） */
  max-width: 100%;
  max-height: 88vh;
  width: auto;
  height: auto;
  object-fit: contain;
}
  .modalCap{
    padding:10px 12px 12px;
    color:#374151;
    font-size:13px;
    background:#fff;
  }

  .note{
    padding:12px 14px;
    border-top:1px solid var(--line);
    color:var(--muted);
    font-size:12px;
    line-height:1.6;
    background:rgba(17,24,39,0.02);
  }
  code{
    background:rgba(17,24,39,0.06);
    border:1px solid rgba(17,24,39,0.10);
    padding:2px 6px;
    border-radius:10px;
  }
</style>
</head>

<body>
<header>
  <div class="wrap">
    <h1>木材加工の案内所</h1>
    <div class="sub">自分の進度に合わせて確認してみよう！／画像はタップで拡大、左右スワイプで切替</div>
  </div>
</header>

<main>
  <div class="grid">
    <!-- Left: Player & Details -->
    <section class="card" aria-label="表示エリア">
      <div class="cardHead">
        <div class="title">学習を選択中</div>
        <div class="chip" id="statusChip">未選択</div>
      </div>

      <div class="playerArea">
        <video id="player" controls playsinline style="display:none;"></video>

        <div id="desc" class="desc" style="display:none;"></div>

        <div id="thumbs" class="thumbs" style="display:none;"></div>

        <div class="note">
        
        </div>
      </div>
    </section>

    <!-- Right: List -->
    <section class="card" aria-label="一覧">
      <div class="cardHead">
        <div class="title">一覧</div>
        <div class="chip"><span id="count">0</span> 件</div>
      </div>

      <div class="listArea">
        <input id="search" type="search" placeholder="タイトルで検索…" />
        <div class="count">タップして表示（動画がなければ画像と説明だけ表示）</div>
        <ul id="list"></ul>
      </div>
    </section>
  </div>
</main>

<!-- Modal (image zoom) -->
<div id="modal" class="modal" aria-label="画像拡大表示">
  <div class="modalInner" role="dialog" aria-modal="true">
    <div class="modalTop">
      <div class="hint" id="modalHint">画像</div>
      <div class="modalBtns">
        <button class="btn" id="btnPrevImg" type="button">◀</button>
        <button class="btn" id="btnNextImg" type="button">▶</button>
        <button class="btn" id="btnClose" type="button">閉じる</button>
      </div>
    </div>
    <div class="modalImgWrap" id="modalSwipeArea">
      <img id="modalImg" class="modalImg" alt="拡大画像" />
    </div>
    <div class="modalCap" id="modalCap">左右スワイプでも切替できます</div>
  </div>
</div>

<script>
/**
 * =======================
 * ここだけ編集すればOK
 * =======================
 * title:       一覧に出すタイトル（必須推奨）
 * src:         動画ファイルへの相対パス（動画がないなら "" でOK）
 * description: 説明文（""でもOK）
 * images:      画像を複数入れたいときは配列で（0枚でもOK）
 *              例: ["images/01.png", "images/02.png"]
 */
const items = [
  {
    title: "①ラフ構想",
    src: "",
    description: "まずは自分の構想をラフに図にしてみよう。とにかくアイディアを出すことが大切！",
    images: ["image/01.png","image/012.png"]
  },
 {
    title: "②tinkerCADによる製図",
    src: "Video/０.mp4",
    description: "構想をCADで形にしてみよう",
    images: []
  },
{
    title: "③材料取図",
    src: "",
    description: "木材から必要な材料をどのように取るか考えてみよう",
    images: ["image/02.png","image/022.png"]
  },
{
    title: "④けがき",
    src: "Video/1.mp4",
    description: "木材に仕上がり寸法線と材料取り寸法線をけがいてみよう",
    images: []
  },
{
    title: "⑤切断",
    src: "Video/２.mp4",
    description: "両刃のこぎりを使って切断してみよう",
    images: []
  },
{
    title: "⑥【選択】部品加工（金やすり）",
    src: "Video/３.mp4",
    description: "仕上がり寸法線まで削ろう。安全で細かい作業はこの道具が一番",
    images: []
  },
{
    title: "⑥【選択】部品加工（ベルトサンダー）",
    src: "Video/４.mp4",
    description: "削る量が多いときはこの道具。安全面注意",
    images: []
  },
{
    title: "⑥【選択】部品加工（かんな）",
    src: "Video/５.mp4",
    description: "木端面を削るときはこの道具",
    images: []
  },
{
    title: "⑦組み立て補助線と釘の位置けがき",
    src: "Video/６.mp4",
    description: "組み立ての時に、取付位置を決めるための補助線をけがく、また釘の打ち込む位置をけがく",
    images: []
  },
{
    title: "⑧下穴加工（卓上ボール盤）",
    src: "Video/７.mp4",
    description: "下穴を卓上ボール盤を使ってあける。その理由は二つ。考えてみよう",
    images: []
  },
{
    title: "⑨組み立て",
    src: "Video/８.mp4",
    description: "玄翁を使って釘を打ち込む。ボンドと併用することでより丈夫になる",
    images: []
  },
{
    title: "⑩仕上げ加工（やすりがけ）",
    src: "Video/９.mp4",
    description: "♯８０→♯１８０→♯２４０→♯４００の順番にやすり掛けをおこなう",
    images: []
  },
{
    title: "⑪仕上げ塗装（蜜蝋ワックス）",
    src: "Video/１０.mp4",
    description: "念入りにやすりの粉を落とした後に、まんべんなくワックスを塗り込む",
    images: []
  },

  // ---- 例（動画あり＋画像複数）----
  // {
  //   title: "② 丸ノコの基本",
  //   src: "videos/02.mp4",
  //   description: "材料固定→姿勢→刃の進め方。\n・手袋は状況で判断\n・保護メガネ必須",
  //   images: ["images/02-1.png", "images/02-2.png"]
  // },

  // ---- 例（動画なし：画像＋説明だけ）----
  // {
  //   title: "① ラフ構想（図だけ）",
  //   src: "",
  //   description: "この段階では寸法は厳密でなくてOK。\n加工の順番と安全を先に考える。",
  //   images: ["images/01.png"]
  // }
];

/* =======================
 * ここから下は触らなくてOK
 * ======================= */

const elPlayer = document.getElementById("player");
const elDesc   = document.getElementById("desc");
const elThumbs = document.getElementById("thumbs");
const elList   = document.getElementById("list");
const elSearch = document.getElementById("search");
const elCount  = document.getElementById("count");
const elChip   = document.getElementById("statusChip");

const elModal  = document.getElementById("modal");
const elModalImg = document.getElementById("modalImg");
const elModalHint = document.getElementById("modalHint");
const elModalCap  = document.getElementById("modalCap");
const btnPrevImg = document.getElementById("btnPrevImg");
const btnNextImg = document.getElementById("btnNextImg");
const btnClose   = document.getElementById("btnClose");
const swipeArea  = document.getElementById("modalSwipeArea");

let currentOriginalIndex = -1;
let filtered = [];
let modalImages = [];
let modalIndex = 0;

// 空行対策：titleかsrcかimagesかdescriptionのどれかがあれば表示対象
function normalize(arr){
  return arr
    .map((v, idx) => ({...v, _idx: idx}))
    .filter(v => {
      const hasTitle = (v.title||"").trim().length>0;
      const hasSrc   = (v.src||"").trim().length>0;
      const hasDesc  = (v.description||"").trim().length>0;
      const hasImgs  = Array.isArray(v.images) && v.images.length>0 && (v.images[0]||"").trim().length>0;
      return hasTitle || hasSrc || hasDesc || hasImgs;
    })
    .map(v => {
      // images が未定義なら空配列に
      if(!Array.isArray(v.images)) v.images = [];
      // images 内の空文字は削除
      v.images = v.images.map(s => (s||"").trim()).filter(Boolean);
      v.title = (v.title||"").trim();
      v.src = (v.src||"").trim();
      v.description = (v.description||"").trim();
      return v;
    });
}

function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function renderList(){
  const q = (elSearch.value||"").trim().toLowerCase();
  const base = normalize(items);

  filtered = base.filter(v => (v.title||"").toLowerCase().includes(q));
  elCount.textContent = String(filtered.length);

  elList.innerHTML = "";
  filtered.forEach((v, i) => {
    const li = document.createElement("li");
    li.className = "item" + (v._idx === currentOriginalIndex ? " active" : "");
    li.dataset.index = String(v._idx);

    const hintParts = [];
    if(v.src) hintParts.push("動画あり");
    if(v.images.length) hintParts.push(`画像${v.images.length}枚`);
    if(v.description) hintParts.push("説明あり");
    const hint = hintParts.length ? hintParts.join(" / ") : "（内容なし）";

    li.innerHTML = `
      <div class="num">${String(i+1).padStart(2,"0")}</div>
      <div class="meta">
        <div class="name">${escapeHtml(v.title || "（無題）")}</div>
        <div class="mini">${escapeHtml(hint)}</div>
      </div>
    `;
    li.addEventListener("click", () => selectItem(v._idx));
    elList.appendChild(li);
  });
}

function setChip(text){
  elChip.textContent = text;
}

function clearPlayer(){
  elPlayer.pause();
  elPlayer.removeAttribute("src");
  elPlayer.load();
  elPlayer.style.display = "none";
}

function selectItem(originalIdx){
  const base = normalize(items);
  const v = base.find(x => x._idx === originalIdx);
  if(!v) return;

  currentOriginalIndex = originalIdx;

  // 動画：srcがあるときだけ表示
  if(v.src){
    elPlayer.style.display = "block";
    elPlayer.src = v.src;
    elPlayer.load();
    // iPad安定のため自動再生はしない（ユーザータップで再生）
  } else {
    clearPlayer();
  }

  // 説明文：あれば表示
  if(v.description){
    elDesc.style.display = "block";
    elDesc.textContent = v.description;
  } else {
    elDesc.style.display = "none";
    elDesc.textContent = "";
  }

  // 画像：複数サムネ表示（なければ非表示）
  elThumbs.innerHTML = "";
  if(v.images.length){
    elThumbs.style.display = "grid";
    v.images.forEach((src, idx) => {
      const img = document.createElement("img");
      img.className = "thumb";
      img.src = src;
      img.alt = "補足画像";
      img.addEventListener("click", () => openModal(v.images, idx, v.title || "画像"));
      elThumbs.appendChild(img);
    });
  } else {
    elThumbs.style.display = "none";
  }

  // ステータス表示
  const parts = [];
  parts.push(v.title ? v.title : "（無題）");
  if(v.src) parts.push("動画");
  if(v.images.length) parts.push(`画像${v.images.length}`);
  if(!v.src && !v.images.length) parts.push("（表示物なし）");
  setChip(parts.join(" / "));

  // 選択保存（復元用）
  try{ localStorage.setItem("kz_selected", String(currentOriginalIndex)); }catch(_){}

  renderList();
}

function openModal(images, startIndex, title){
  modalImages = images || [];
  modalIndex = Math.max(0, Math.min(startIndex||0, modalImages.length-1));

  elModal.style.display = "flex";
  updateModal(title);
}

function updateModal(title){
  if(!modalImages.length){
    elModalImg.removeAttribute("src");
    elModalHint.textContent = title || "画像";
    elModalCap.textContent = "画像がありません";
    return;
  }
  elModalImg.src = modalImages[modalIndex];
  elModalHint.textContent = `${title || "画像"}（${modalIndex+1}/${modalImages.length}）`;
  elModalCap.textContent = "左右ボタン or 左右スワイプで切替／外側タップで閉じる";
}

function modalMove(delta){
  if(!modalImages.length) return;
  modalIndex = (modalIndex + delta + modalImages.length) % modalImages.length;
  updateModal(elModalHint.textContent.split("（")[0]);
}

btnPrevImg.addEventListener("click", () => modalMove(-1));
btnNextImg.addEventListener("click", () => modalMove(+1));
btnClose.addEventListener("click", () => elModal.style.display = "none");

// モーダルの外側タップで閉じる
elModal.addEventListener("click", (e) => {
  if(e.target === elModal) elModal.style.display = "none";
});

// iPad想定：左右スワイプで画像切替（簡易）
let startX = null;
swipeArea.addEventListener("touchstart", (e) => {
  if(!e.touches || !e.touches[0]) return;
  startX = e.touches[0].clientX;
}, {passive:true});

swipeArea.addEventListener("touchend", (e) => {
  if(startX === null) return;
  const endX = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientX : startX;
  const dx = endX - startX;
  startX = null;

  // 閾値（小さすぎる誤動作を防ぐ）
  if(Math.abs(dx) < 40) return;
  if(dx < 0) modalMove(+1); // 左へスワイプ→次
  else modalMove(-1);       // 右へスワイプ→前
}, {passive:true});

// 検索
elSearch.addEventListener("input", renderList);

// 初期化：前回選択を復元（あれば）
function init(){
  renderList();
  try{
    const s = localStorage.getItem("kz_selected");
    if(s !== null){
      const idx = Number(s);
      if(Number.isFinite(idx)) selectItem(idx);
      return;
    }
  }catch(_){}
  setChip("未選択");
}
init();
</script>

</body>
</html>